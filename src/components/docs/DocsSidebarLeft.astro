---
import { getCollection } from "astro:content";
import { parseDocCollectionId, sortDocPages } from "@/utils/docs";

interface Props {
  currentSlug: string;
}

const { currentSlug } = Astro.props;

const docsCollection = await getCollection("docsPages");
const sortedPages = sortDocPages(docsCollection);

const navItems = sortedPages.map((page) => {
  const parsed = parseDocCollectionId(page.id, true);
  const cleanSlug = page.id
    .split("/")
    .map((part) => part.replace(/^\d+-/, ""))
    .join("/");

  return {
    title: parsed.title,
    href: `/docs/${cleanSlug}`,
    isActive: currentSlug === cleanSlug,
  };
});
---

<aside
  class="docs-sidebar-left fixed top-0 left-0 hidden h-screen w-64 overflow-y-auto px-6 py-8 pt-24 lg:block"
>
  <nav aria-label="Documentation navigation">
    <ul class="space-y-1">
      {
        navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class:list={[
                "block rounded px-3 py-2 text-sm transition-colors",
                item.isActive
                  ? "bg-[#89b29e1a] font-semibold text-[#89b29e]"
                  : "text-[#e0e0e0] hover:bg-[#89b29e0d] hover:text-[#89b29e]",
              ]}
              aria-current={item.isActive ? "page" : undefined}
            >
              {item.title}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</aside>
